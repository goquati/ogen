openapi: 3.0.4
info:
  title: test spec
  version: 1.0.0
paths:
  /api/v1/users:
    get:
      tags:
        - users
      operationId: getUsers
      parameters:
        - $ref: "#/components/parameters/TenantIdQuery"
        - name: isEmailVerified
          in: query
          required: false
          schema:
            type: boolean
        - name: search
          in: query
          required: false
          schema:
            type: string
        - name: email
          in: query
          required: false
          schema:
            type: string
            format: email
      responses:
        '200':
          description: "get users"
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
            application/stream+json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/User"
    post:
      tags:
        - users
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: "created user"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"

  /api/v1/users/{userId}:
    parameters:
      - $ref: "#/components/parameters/UserIdPath"
    get:
      tags:
        - users
      summary: "Get user by ID"
      operationId: getUser
      responses:
        '200':
          description: "get user"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
    put:
      tags:
        - users
      summary: "Update user"
      operationId: updateUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        '200':
          description: "updated user"
    delete:
      tags:
        - users
      summary: "Delete user"
      operationId: deleteUser
      responses:
        '200':
          description: "delete user"

  /api/v1/users/{userId}/files/{fileId}:
    parameters:
      - $ref: "#/components/parameters/UserIdPath"
      - name: fileId
        in: path
        required: true
        schema:
          type: string
    get:
      tags:
        - users
      operationId: getUserFile
      parameters:
        - name: X-Request-ID
          in: header
          required: false
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: "get file"
          headers:
            X-File-Type:
              schema:
                type: string
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary

  /api/v1/users/{userId}:set-password-change-action:
    parameters:
      - $ref: "#/components/parameters/UserIdPath"
    post:
      tags:
        - users
      operationId: setPasswordChangeAction
      responses:
        '201':
          description: "password change action set"

  /api/v1/users/{userId}:email-change-request:
    parameters:
      - $ref: "#/components/parameters/UserIdPath"
    post:
      tags:
        - users
      operationId: createEmailChangeRequest
      parameters:
        - name: email
          in: query
          required: true
          schema:
            type: string
            format: email
        - name: locale
          in: query
          required: false
          schema:
            $ref: "#/components/schemas/Locale"
      responses:
        '201':
          description: "email confirmation send to new address"

  /api/v1/public/debug:
    get:
      tags:
        - debug
      operationId: debugInfo
      security: [ ]
      deprecated: true
      parameters:
        - name: debug-session
          in: cookie
          schema:
            type: string
      responses:
        '200':
          description: "debug info"

security:
  - user: [ ]
  - service: [ ]

components:
  parameters:
    UserIdPath:
      name: userId
      in: path
      required: true
      schema:
        $ref: "#/components/schemas/UserId"
    TenantIdQuery:
      name: tenantId
      in: query
      required: false
      schema:
        $ref: "#/components/schemas/TenantId"
  securitySchemes:
    user:
      type: http
      scheme: bearer
      bearerFormat: JWT
    service:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    UserId:
      type: string
      format: uuid
    TenantId:
      type: string
      format: uuid
    Locale:
      type: string
      enum:
        - en
        - de
    User:
      type: object
      required:
        - id
        - firstName
        - lastName
        - email
        - isEmailVerified
        - locale
        - tenants
      properties:
        id:
          $ref: "#/components/schemas/UserId"
        firstName:
          type: string
          nullable: true
        lastName:
          type: string
          nullable: true
        email:
          type: string
          format: email
        isEmailVerified:
          type: boolean
        locale:
          $ref: "#/components/schemas/Locale"
        tenants:
          type: array
          items:
            $ref: "#/components/schemas/TenantId"
    UserCreate:
      type: object
      required:
        - email
        - id
        - tenants
      properties:
        firstName:
          type: string
          nullable: true
        lastName:
          type: string
          nullable: true
        email:
          type: string
          format: email
        locale:
          allOf:
            - $ref: "#/components/schemas/Locale"
          nullable: true
        isEmailVerified:
          type: boolean
        tenants:
          type: array
          items:
            $ref: "#/components/schemas/TenantId"
    UserUpdate:
      type: object
      properties:
        firstName:
          type: string
          nullable: true
        lastName:
          type: string
          nullable: true
        locale:
          $ref: "#/components/schemas/Locale"
